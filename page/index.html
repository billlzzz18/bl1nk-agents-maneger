<!DOCTYPE html>
<html lang="th" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ashval Task Assistant Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE',
                        secondary: '#8B5FBF',
                        accent: '#FF6B9D',
                        success: '#4ADE80',
                        warning: '#FBBF24',
                        error: '#EF4444',
                        dark: '#181818',
                        light: '#FFFFFF'
                    },
                    fontSize: {
                        'xs': '0.75rem',
                        'sm': '0.875rem', 
                        'base': '1rem',
                        'lg': '1.125rem',
                        'xl': '1.25rem',
                        '2xl': '1.5rem',
                        '3xl': '1.875rem'
                    },
                    animation: {
                        'bounce-slow': 'bounce 2s infinite',
                        'pulse-slow': 'pulse 3s infinite',
                        'wiggle': 'wiggle 1s ease-in-out infinite',
                    },
                    keyframes: {
                        wiggle: {
                            '0%, 100%': { transform: 'rotate(-3deg)' },
                            '50%': { transform: 'rotate(3deg)' },
                        }
                    }
                }
            },
            darkMode: 'class'
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@300;400;500;600;700&display=swap');
        
        * {
            font-family: 'Noto Sans Thai', sans-serif;
        }
        
        /* 3D Button Effects */
        .btn-3d {
            transform: translateY(0px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15), 0 0 0 1px rgba(255,255,255,0.1) inset;
            transition: all 0.2s ease;
        }
        
        .btn-3d:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.2), 0 0 0 1px rgba(255,255,255,0.2) inset;
        }
        
        .btn-3d:active {
            transform: translateY(1px);
            box-shadow: 0 3px 8px rgba(0,0,0,0.2), 0 0 0 1px rgba(255,255,255,0.1) inset;
        }
        
        .btn-3d-primary {
            background: linear-gradient(145deg, #6366f1, #4f46e5);
        }
        
        .btn-3d-secondary {
            background: linear-gradient(145deg, #a855f7, #9333ea);
        }
        
        .btn-3d-success {
            background: linear-gradient(145deg, #22c55e, #16a34a);
        }
        
        .btn-3d-warning {
            background: linear-gradient(145deg, #f59e0b, #d97706);
        }
        
        .btn-3d-error {
            background: linear-gradient(145deg, #ef4444, #dc2626);
        }
        
        /* Task Card Effects */
        .task-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border-left: 4px solid transparent;
            background: linear-gradient(145deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
            backdrop-filter: blur(10px);
        }
        
        .task-card:hover {
            transform: translateY(-4px) translateX(2px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        .task-card.priority-high {
            border-left-color: #EF4444;
            background: linear-gradient(145deg, rgba(239,68,68,0.1), rgba(239,68,68,0.05));
        }
        
        .task-card.priority-medium {
            border-left-color: #FBBF24;
            background: linear-gradient(145deg, rgba(251,191,36,0.1), rgba(251,191,36,0.05));
        }
        
        .task-card.priority-low {
            border-left-color: #4ADE80;
            background: linear-gradient(145deg, rgba(74,222,128,0.1), rgba(74,222,128,0.05));
        }
        
        /* Sidebar Animation */
        .sidebar {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .sidebar-collapsed {
            width: 4rem;
        }
        
        .sidebar-collapsed .sidebar-text {
            opacity: 0;
            transform: translateX(-10px);
        }
        
        .sidebar-text {
            transition: all 0.3s ease;
        }
        
        /* Mood Button */
        .mood-button {
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            transform-style: preserve-3d;
        }
        
        .mood-button:hover {
            transform: scale(1.05) rotateY(5deg);
        }
        
        .mood-button.active {
            transform: scale(1.1) rotateY(10deg);
            box-shadow: 0 15px 30px rgba(93, 92, 222, 0.4);
        }
        
        /* Floating Elements */
        .floating-add {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            z-index: 1000;
            transition: all 0.3s ease;
        }
        
        .floating-add:hover {
            transform: scale(1.1) rotate(90deg);
        }
        
        /* Gallery Grid */
        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }
        
        .gallery-item {
            transition: all 0.3s ease;
            border-radius: 1rem;
            overflow: hidden;
            background: linear-gradient(145deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
            backdrop-filter: blur(10px);
        }
        
        .gallery-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
        }
        
        /* API Status Indicators */
        .api-status {
            position: relative;
            display: inline-block;
        }
        
        .api-status::before {
            content: '';
            position: absolute;
            top: -2px;
            right: -2px;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #4ADE80;
            animation: pulse 2s infinite;
        }
        
        .api-status.disconnected::before {
            background: #EF4444;
        }
        
        /* Loading Spinner */
        .loading-spinner {
            border: 3px solid rgba(93, 92, 222, 0.3);
            border-radius: 50%;
            border-top: 3px solid #5D5CDE;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Notification */
        .notification {
            position: fixed;
            top: 1rem;
            right: 1rem;
            z-index: 1001;
            min-width: 300px;
        }
        
        /* Media Embed */
        .media-embed {
            aspect-ratio: 16/9;
            border-radius: 0.5rem;
            overflow: hidden;
        }
        
        /* Glassmorphism */
        .glass {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .glass-dark {
            background: rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-purple-50 via-blue-50 to-indigo-100 dark:from-gray-900 dark:via-purple-900 dark:to-indigo-900 text-gray-900 dark:text-gray-100 h-full">
    <div x-data="ashvalApp()" x-init="init()" class="flex h-screen overflow-hidden">
        <!-- Notification -->
        <div x-show="notification.show" 
             x-transition:enter="transition ease-out duration-300"
             x-transition:enter-start="opacity-0 transform translate-x-full"
             x-transition:enter-end="opacity-100 transform translate-x-0"
             x-transition:leave="transition ease-in duration-200"
             x-transition:leave-start="opacity-100 transform translate-x-0"
             x-transition:leave-end="opacity-0 transform translate-x-full"
             class="notification">
            <div :class="notification.type === 'success' ? 'bg-success' : notification.type === 'error' ? 'bg-error' : 'bg-primary'"
                 class="text-white p-4 rounded-lg shadow-lg flex items-center glass">
                <i :class="notification.type === 'success' ? 'fas fa-check-circle' : notification.type === 'error' ? 'fas fa-exclamation-circle' : 'fas fa-info-circle'" 
                   class="mr-3 text-xl"></i>
                <span x-text="notification.message" class="flex-1"></span>
                <button @click="hideNotification()" class="ml-3 text-white hover:text-gray-200 transition-colors">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>

        <!-- Sidebar -->
        <div :class="sidebarCollapsed ? 'sidebar-collapsed' : 'w-64'"
             class="sidebar bg-white/80 dark:bg-gray-800/80 shadow-lg flex flex-col glass backdrop-blur-lg">
            
            <!-- Header with Toggle -->
            <div class="p-4 border-b border-gray-200/50 dark:border-gray-700/50 flex items-center">
                <button @click="toggleSidebar()" 
                        class="btn-3d btn-3d-primary text-white p-2 rounded-lg mr-3">
                    <i :class="sidebarCollapsed ? 'fas fa-bars' : 'fas fa-times'" class="text-sm"></i>
                </button>
                <div x-show="!sidebarCollapsed" class="sidebar-text">
                    <h1 class="text-xl font-bold text-primary flex items-center">
                        <i class="fas fa-brain mr-2"></i>
                        Ashval Pro
                    </h1>
                    <p class="text-xs text-gray-600 dark:text-gray-400 mt-1">ผู้ช่วยจัดการงานอัจฉริยะ</p>
                </div>
            </div>
            
            <!-- Navigation -->
            <nav class="flex-1 p-2 overflow-y-auto">
                <ul class="space-y-1">
                    <li>
                        <button @click="currentView = 'dashboard'" 
                                :class="currentView === 'dashboard' ? 'btn-3d-primary text-white' : 'text-gray-700 dark:text-gray-300 hover:bg-gray-100/50 dark:hover:bg-gray-700/50'"
                                class="w-full text-left px-3 py-2 rounded-lg transition-all flex items-center btn-3d">
                            <i class="fas fa-home text-lg" :class="sidebarCollapsed ? 'mx-auto' : 'mr-3'"></i>
                            <span x-show="!sidebarCollapsed" class="sidebar-text text-sm font-medium">แดชบอร์ด</span>
                        </button>
                    </li>
                    <li>
                        <button @click="currentView = 'tasks'" 
                                :class="currentView === 'tasks' ? 'btn-3d-primary text-white' : 'text-gray-700 dark:text-gray-300 hover:bg-gray-100/50 dark:hover:bg-gray-700/50'"
                                class="w-full text-left px-3 py-2 rounded-lg transition-all flex items-center btn-3d">
                            <i class="fas fa-tasks text-lg" :class="sidebarCollapsed ? 'mx-auto' : 'mr-3'"></i>
                            <div x-show="!sidebarCollapsed" class="sidebar-text flex items-center justify-between flex-1">
                                <span class="text-sm font-medium">งานทั้งหมด</span>
                                <span class="bg-primary/20 text-primary px-2 py-1 rounded-full text-xs" x-text="getTotalTasks()"></span>
                            </div>
                        </button>
                    </li>
                    <li>
                        <button @click="currentView = 'mood'" 
                                :class="currentView === 'mood' ? 'btn-3d-primary text-white' : 'text-gray-700 dark:text-gray-300 hover:bg-gray-100/50 dark:hover:bg-gray-700/50'"
                                class="w-full text-left px-3 py-2 rounded-lg transition-all flex items-center btn-3d">
                            <i class="fas fa-smile text-lg" :class="sidebarCollapsed ? 'mx-auto' : 'mr-3'"></i>
                            <div x-show="!sidebarCollapsed" class="sidebar-text flex items-center justify-between flex-1">
                                <span class="text-sm font-medium">อารมณ์วันนี้</span>
                                <span x-show="currentMood" class="text-lg" x-text="currentMood?.emoji"></span>
                            </div>
                        </button>
                    </li>
                    <li>
                        <button @click="currentView = 'ai'" 
                                :class="currentView === 'ai' ? 'btn-3d-primary text-white' : 'text-gray-700 dark:text-gray-300 hover:bg-gray-100/50 dark:hover:bg-gray-700/50'"
                                class="w-full text-left px-3 py-2 rounded-lg transition-all flex items-center btn-3d">
                            <i class="fas fa-robot text-lg" :class="sidebarCollapsed ? 'mx-auto' : 'mr-3'"></i>
                            <div x-show="!sidebarCollapsed" class="sidebar-text flex items-center justify-between flex-1">
                                <span class="text-sm font-medium">AI แนะนำงาน</span>
                                <div x-show="aiLoading" class="loading-spinner"></div>
                            </div>
                        </button>
                    </li>
                    <li>
                        <button @click="currentView = 'media'" 
                                :class="currentView === 'media' ? 'btn-3d-primary text-white' : 'text-gray-700 dark:text-gray-300 hover:bg-gray-100/50 dark:hover:bg-gray-700/50'"
                                class="w-full text-left px-3 py-2 rounded-lg transition-all flex items-center btn-3d">
                            <i class="fas fa-play-circle text-lg" :class="sidebarCollapsed ? 'mx-auto' : 'mr-3'"></i>
                            <div x-show="!sidebarCollapsed" class="sidebar-text flex items-center justify-between flex-1">
                                <span class="text-sm font-medium">สื่อมัลติมีเดีย</span>
                                <span class="bg-accent/20 text-accent px-2 py-1 rounded-full text-xs" x-text="mediaItems.length"></span>
                            </div>
                        </button>
                    </li>
                    <li>
                        <button @click="currentView = 'gallery'" 
                                :class="currentView === 'gallery' ? 'btn-3d-primary text-white' : 'text-gray-700 dark:text-gray-300 hover:bg-gray-100/50 dark:hover:bg-gray-700/50'"
                                class="w-full text-left px-3 py-2 rounded-lg transition-all flex items-center btn-3d">
                            <i class="fas fa-images text-lg" :class="sidebarCollapsed ? 'mx-auto' : 'mr-3'"></i>
                            <div x-show="!sidebarCollapsed" class="sidebar-text flex items-center justify-between flex-1">
                                <span class="text-sm font-medium">แกลเลอรี่</span>
                                <span class="bg-secondary/20 text-secondary px-2 py-1 rounded-full text-xs" x-text="galleryItems.length"></span>
                            </div>
                        </button>
                    </li>
                    <li>
                        <button @click="currentView = 'api'" 
                                :class="currentView === 'api' ? 'btn-3d-primary text-white' : 'text-gray-700 dark:text-gray-300 hover:bg-gray-100/50 dark:hover:bg-gray-700/50'"
                                class="w-full text-left px-3 py-2 rounded-lg transition-all flex items-center btn-3d">
                            <i class="fas fa-plug text-lg" :class="sidebarCollapsed ? 'mx-auto' : 'mr-3'"></i>
                            <div x-show="!sidebarCollapsed" class="sidebar-text flex items-center justify-between flex-1">
                                <span class="text-sm font-medium">API เชื่อมต่อ</span>
                                <span class="bg-success/20 text-success px-2 py-1 rounded-full text-xs" x-text="getConnectedAPIs()"></span>
                            </div>
                        </button>
                    </li>
                </ul>
            </nav>
            
            <!-- Settings & Dark Mode Toggle -->
            <div x-show="!sidebarCollapsed" class="p-2 border-t border-gray-200/50 dark:border-gray-700/50 space-y-1 sidebar-text">
                <button @click="exportData()" 
                        class="w-full px-3 py-2 rounded-lg btn-3d btn-3d-secondary text-white transition-all flex items-center text-sm">
                    <i class="fas fa-download mr-2"></i>
                    ส่งออกข้อมูล
                </button>
                <button @click="toggleDarkMode()" 
                        class="w-full px-3 py-2 rounded-lg btn-3d btn-3d-warning text-white transition-all flex items-center text-sm">
                    <i :class="isDark ? 'fas fa-sun' : 'fas fa-moon'" class="mr-2"></i>
                    <span x-text="isDark ? 'โหมดสว่าง' : 'โหมดมืด'"></span>
                </button>
            </div>
        </div>

        <!-- Main Content -->
        <div class="flex-1 flex flex-col overflow-hidden">
            <!-- Top Bar -->
            <header class="bg-white/80 dark:bg-gray-800/80 shadow-sm border-b border-gray-200/50 dark:border-gray-700/50 p-4 glass backdrop-blur-lg">
                <div class="flex items-center justify-between">
                    <div>
                        <h2 class="text-xl font-semibold bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent" x-text="getViewTitle()"></h2>
                        <p class="text-sm text-gray-600 dark:text-gray-400" x-text="getCurrentDateTime()"></p>
                    </div>
                    <div class="flex items-center space-x-3">
                        <!-- API Status Indicators -->
                        <div class="flex items-center space-x-2">
                            <div class="api-status" :class="!window.Poe ? 'disconnected' : ''">
                                <i class="fas fa-robot text-primary"></i>
                            </div>
                            <div class="api-status" :class="!apiConnections.youtube ? 'disconnected' : ''">
                                <i class="fab fa-youtube text-red-500"></i>
                            </div>
                            <div class="api-status" :class="!apiConnections.spotify ? 'disconnected' : ''">
                                <i class="fab fa-spotify text-green-500"></i>
                            </div>
                            <div class="api-status" :class="!notionConnected ? 'disconnected' : ''">
                                <i class="fab fa-notion text-gray-700 dark:text-gray-300"></i>
                            </div>
                        </div>
                        
                        <!-- Current Mood Display -->
                        <div x-show="currentMood" class="glass px-3 py-2 rounded-lg">
                            <span class="text-lg mr-2" x-text="currentMood?.emoji"></span>
                            <span class="text-sm font-medium" x-text="currentMood?.name"></span>
                        </div>
                        
                        <!-- Quick Add Button -->
                        <button @click="showQuickAdd = true" 
                                class="btn-3d btn-3d-primary text-white px-4 py-2 rounded-lg transition-all flex items-center">
                            <i class="fas fa-plus mr-2"></i>
                            <span class="hidden sm:inline">เพิ่มงาน</span>
                        </button>
                    </div>
                </div>
            </header>

            <!-- Content Area -->
            <main class="flex-1 overflow-auto p-6">
                <!-- Dashboard View -->
                <div x-show="currentView === 'dashboard'" class="fade-in space-y-6">
                    <!-- Stats Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <div class="glass p-6 rounded-xl hover:transform hover:scale-105 transition-all duration-300">
                            <div class="flex items-center">
                                <div class="p-3 bg-primary/20 rounded-lg">
                                    <i class="fas fa-tasks text-primary text-xl"></i>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm text-gray-600 dark:text-gray-400">งานทั้งหมด</p>
                                    <p class="text-2xl font-bold" x-text="getTotalTasks()"></p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="glass p-6 rounded-xl hover:transform hover:scale-105 transition-all duration-300">
                            <div class="flex items-center">
                                <div class="p-3 bg-success/20 rounded-lg">
                                    <i class="fas fa-check text-success text-xl"></i>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm text-gray-600 dark:text-gray-400">เสร็จแล้ว</p>
                                    <p class="text-2xl font-bold" x-text="getCompletedTasks()"></p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="glass p-6 rounded-xl hover:transform hover:scale-105 transition-all duration-300">
                            <div class="flex items-center">
                                <div class="p-3 bg-warning/20 rounded-lg">
                                    <i class="fas fa-clock text-warning text-xl"></i>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm text-gray-600 dark:text-gray-400">กำลังทำ</p>
                                    <p class="text-2xl font-bold" x-text="getInProgressTasks()"></p>
                                </div>
                            </div>
                        </div>

                        <div class="glass p-6 rounded-xl hover:transform hover:scale-105 transition-all duration-300">
                            <div class="flex items-center">
                                <div class="p-3 bg-accent/20 rounded-lg">
                                    <i class="fas fa-play text-accent text-xl"></i>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm text-gray-600 dark:text-gray-400">สื่อมัลติมีเดีย</p>
                                    <p class="text-2xl font-bold" x-text="mediaItems.length"></p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                        <button @click="currentView = 'mood'; selectRandomMood()" 
                                class="btn-3d p-6 bg-gradient-to-br from-purple-500 to-pink-500 text-white rounded-xl hover:shadow-2xl transition-all duration-300">
                            <i class="fas fa-smile text-3xl mb-3 animate-bounce-slow"></i>
                            <div class="font-semibold">เลือกอารมณ์</div>
                            <div class="text-sm opacity-80">วิเคราะห์ความรู้สึก</div>
                        </button>
                        
                        <button @click="currentView = 'ai'; setQuickPrompt('วางแผนงานประจำวัน')" 
                                class="btn-3d p-6 bg-gradient-to-br from-blue-500 to-teal-500 text-white rounded-xl hover:shadow-2xl transition-all duration-300">
                            <i class="fas fa-robot text-3xl mb-3 animate-pulse-slow"></i>
                            <div class="font-semibold">ปรึกษา AI</div>
                            <div class="text-sm opacity-80">ขอคำแนะนำอัจฉริยะ</div>
                        </button>
                        
                        <button @click="currentView = 'media'; showMediaAdd = true" 
                                class="btn-3d p-6 bg-gradient-to-br from-red-500 to-orange-500 text-white rounded-xl hover:shadow-2xl transition-all duration-300">
                            <i class="fas fa-play-circle text-3xl mb-3 animate-wiggle"></i>
                            <div class="font-semibold">เพิ่มสื่อ</div>
                            <div class="text-sm opacity-80">YouTube, Spotify</div>
                        </button>
                        
                        <button @click="currentView = 'gallery'" 
                                class="btn-3d p-6 bg-gradient-to-br from-green-500 to-emerald-500 text-white rounded-xl hover:shadow-2xl transition-all duration-300">
                            <i class="fas fa-images text-3xl mb-3 animate-pulse"></i>
                            <div class="font-semibold">แกลเลอรี่</div>
                            <div class="text-sm opacity-80">ดูผลงานทั้งหมด</div>
                        </button>
                    </div>

                    <!-- Recent Tasks -->
                    <div class="glass rounded-xl p-6">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold">งานล่าสุด</h3>
                            <button @click="currentView = 'tasks'" class="text-primary hover:text-primary/80 text-sm btn-3d px-3 py-1 rounded-lg">
                                ดูทั้งหมด <i class="fas fa-arrow-right ml-1"></i>
                            </button>
                        </div>
                        <div class="space-y-3">
                            <template x-for="task in getRecentTasks()" :key="task.id">
                                <div class="task-card p-4 rounded-lg cursor-pointer"
                                     :class="'priority-' + task.priority"
                                     @click="selectTask(task)">
                                    <div class="flex items-center justify-between">
                                        <div class="flex-1">
                                            <h4 class="font-medium" x-text="task.title"></h4>
                                            <p class="text-sm text-gray-600 dark:text-gray-400" x-text="task.description"></p>
                                            <div class="flex items-center mt-2 space-x-2">
                                                <span class="px-2 py-1 bg-primary/20 text-primary rounded-full text-xs" x-text="getStatusText(task.status)"></span>
                                                <span :class="getPriorityColor(task.priority)" class="px-2 py-1 rounded-full text-xs" x-text="getPriorityText(task.priority)"></span>
                                                <span class="text-xs text-gray-500" x-text="formatDate(task.createdAt)"></span>
                                            </div>
                                        </div>
                                        <button @click.stop="toggleTaskComplete(task)" 
                                                :class="task.completed ? 'text-success' : 'text-gray-400'"
                                                class="ml-4 p-2 hover:bg-gray-200/50 dark:hover:bg-gray-600/50 rounded-lg transition-all btn-3d">
                                            <i class="fas fa-check"></i>
                                        </button>
                                    </div>
                                </div>
                            </template>
                            <div x-show="tasks.length === 0" class="text-center py-8 text-gray-500">
                                <i class="fas fa-tasks text-4xl mb-4 opacity-50"></i>
                                <p class="text-lg mb-2">ยังไม่มีงานในระบบ</p>
                                <button @click="showQuickAdd = true" class="text-primary hover:text-primary/80 btn-3d px-4 py-2 rounded-lg">
                                    เริ่มต้นด้วยการเพิ่มงานแรก
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tasks View -->
                <div x-show="currentView === 'tasks'" class="fade-in space-y-6">
                    <!-- Task Filters -->
                    <div class="glass rounded-xl p-4">
                        <div class="flex flex-wrap items-center gap-4">
                            <div class="flex items-center space-x-2">
                                <label class="text-sm font-medium">สถานะ:</label>
                                <select x-model="taskFilter.status" @change="saveSettings()"
                                        class="px-3 py-2 border border-gray-300/50 dark:border-gray-600/50 rounded-lg bg-white/50 dark:bg-gray-700/50 text-base backdrop-blur">
                                    <option value="">ทั้งหมด</option>
                                    <option value="todo">รอทำ</option>
                                    <option value="doing">กำลังทำ</option>
                                    <option value="done">เสร็จแล้ว</option>
                                </select>
                            </div>
                            <div class="flex items-center space-x-2">
                                <label class="text-sm font-medium">ความสำคัญ:</label>
                                <select x-model="taskFilter.priority" @change="saveSettings()"
                                        class="px-3 py-2 border border-gray-300/50 dark:border-gray-600/50 rounded-lg bg-white/50 dark:bg-gray-700/50 text-base backdrop-blur">
                                    <option value="">ทั้งหมด</option>
                                    <option value="high">สูง</option>
                                    <option value="medium">กลาง</option>
                                    <option value="low">ต่ำ</option>
                                </select>
                            </div>
                            <button @click="clearFilters()" 
                                    class="btn-3d btn-3d-secondary text-white px-4 py-2 rounded-lg transition-all">
                                ล้างตัวกรอง
                            </button>
                            <div class="ml-auto text-sm text-gray-600 dark:text-gray-400">
                                รวม <span class="font-semibold text-primary" x-text="tasks.length"></span> งาน
                            </div>
                        </div>
                    </div>

                    <!-- Kanban Board -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <!-- Todo Column -->
                        <div class="glass rounded-xl p-6">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="font-semibold text-lg flex items-center">
                                    <div class="w-3 h-3 bg-gray-400 rounded-full mr-3 animate-pulse"></div>
                                    รอทำ
                                </h3>
                                <span class="bg-gray-100/50 dark:bg-gray-700/50 px-3 py-1 rounded-full text-sm font-medium" 
                                      x-text="getFilteredTasks('todo').length"></span>
                            </div>
                            <div class="space-y-3 max-h-96 overflow-y-auto">
                                <template x-for="task in getFilteredTasks('todo')" :key="task.id">
                                    <div class="task-card p-4 rounded-lg cursor-pointer"
                                         :class="'priority-' + task.priority"
                                         @click="selectTask(task)">
                                        <div class="flex items-start justify-between">
                                            <div class="flex-1">
                                                <h4 class="font-medium text-base" x-text="task.title"></h4>
                                                <p class="text-sm text-gray-600 dark:text-gray-400 mt-1" x-text="task.description"></p>
                                                <div class="flex items-center justify-between mt-3">
                                                    <span :class="getPriorityColor(task.priority)" 
                                                          class="px-2 py-1 rounded-full text-xs font-medium" 
                                                          x-text="getPriorityText(task.priority)"></span>
                                                    <div class="flex space-x-2">
                                                        <button @click.stop="changeTaskStatus(task, 'doing')" 
                                                                class="btn-3d btn-3d-warning text-white p-1 rounded transition-all"
                                                                title="เริ่มทำงาน">
                                                            <i class="fas fa-play text-xs"></i>
                                                        </button>
                                                        <button @click.stop="toggleTaskComplete(task)" 
                                                                class="btn-3d btn-3d-success text-white p-1 rounded transition-all"
                                                                title="ทำเสร็จ">
                                                            <i class="fas fa-check text-xs"></i>
                                                        </button>
                                                    </div>
                                                </div>
                                                <!-- Subtasks -->
                                                <div x-show="task.subtasks && task.subtasks.length > 0" class="mt-3">
                                                    <div class="text-xs text-gray-500 mb-2">งานย่อย:</div>
                                                    <template x-for="subtask in task.subtasks" :key="subtask.id">
                                                        <div class="text-sm glass p-2 rounded mb-1 flex items-center justify-between">
                                                            <span :class="subtask.completed ? 'line-through opacity-60' : ''" x-text="subtask.title"></span>
                                                            <button @click.stop="toggleSubtaskComplete(task, subtask)" 
                                                                    :class="subtask.completed ? 'text-success' : 'text-gray-400'"
                                                                    class="hover:text-success transition-colors btn-3d p-1 rounded">
                                                                <i class="fas fa-check text-xs"></i>
                                                            </button>
                                                        </div>
                                                    </template>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </template>
                                <div x-show="getFilteredTasks('todo').length === 0" class="text-center py-8 text-gray-500">
                                    <i class="fas fa-inbox text-3xl mb-3 opacity-50"></i>
                                    <p>ไม่มีงานรอทำ</p>
                                </div>
                            </div>
                        </div>

                        <!-- Doing Column -->
                        <div class="glass rounded-xl p-6">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="font-semibold text-lg flex items-center">
                                    <div class="w-3 h-3 bg-warning rounded-full mr-3 animate-pulse"></div>
                                    กำลังทำ
                                </h3>
                                <span class="bg-warning/20 text-warning px-3 py-1 rounded-full text-sm font-medium" 
                                      x-text="getFilteredTasks('doing').length"></span>
                            </div>
                            <div class="space-y-3 max-h-96 overflow-y-auto">
                                <template x-for="task in getFilteredTasks('doing')" :key="task.id">
                                    <div class="task-card p-4 rounded-lg cursor-pointer border-l-4 border-warning"
                                         @click="selectTask(task)">
                                        <div class="flex items-start justify-between">
                                            <div class="flex-1">
                                                <h4 class="font-medium text-base" x-text="task.title"></h4>
                                                <p class="text-sm text-gray-600 dark:text-gray-400 mt-1" x-text="task.description"></p>
                                                <div class="flex items-center justify-between mt-3">
                                                    <span :class="getPriorityColor(task.priority)" 
                                                          class="px-2 py-1 rounded-full text-xs font-medium" 
                                                          x-text="getPriorityText(task.priority)"></span>
                                                    <div class="flex space-x-2">
                                                        <button @click.stop="changeTaskStatus(task, 'todo')" 
                                                                class="btn-3d text-gray-600 dark:text-gray-400 p-1 rounded transition-all"
                                                                title="ย้ายกลับไปรอทำ">
                                                            <i class="fas fa-pause text-xs"></i>
                                                        </button>
                                                        <button @click.stop="toggleTaskComplete(task)" 
                                                                class="btn-3d btn-3d-success text-white p-1 rounded transition-all"
                                                                title="ทำเสร็จ">
                                                            <i class="fas fa-check text-xs"></i>
                                                        </button>
                                                    </div>
                                                </div>
                                                <!-- Progress Bar for Subtasks -->
                                                <div x-show="task.subtasks && task.subtasks.length > 0" class="mt-3">
                                                    <div class="text-xs text-gray-500 mb-1">ความคืบหน้า:</div>
                                                    <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                                                        <div class="bg-success h-2 rounded-full transition-all duration-300" 
                                                             :style="`width: ${(getCompletedSubtasks(task) / task.subtasks.length) * 100}%`"></div>
                                                    </div>
                                                    <div class="text-xs text-gray-500 mt-1">
                                                        <span x-text="getCompletedSubtasks(task)"></span>/<span x-text="task.subtasks.length"></span> งานย่อย
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </template>
                                <div x-show="getFilteredTasks('doing').length === 0" class="text-center py-8 text-gray-500">
                                    <i class="fas fa-clock text-3xl mb-3 opacity-50"></i>
                                    <p>ไม่มีงานที่กำลังทำ</p>
                                </div>
                            </div>
                        </div>

                        <!-- Done Column -->
                        <div class="glass rounded-xl p-6">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="font-semibold text-lg flex items-center">
                                    <div class="w-3 h-3 bg-success rounded-full mr-3 animate-pulse"></div>
                                    เสร็จแล้ว
                                </h3>
                                <span class="bg-success/20 text-success px-3 py-1 rounded-full text-sm font-medium" 
                                      x-text="getFilteredTasks('done').length"></span>
                            </div>
                            <div class="space-y-3 max-h-96 overflow-y-auto">
                                <template x-for="task in getFilteredTasks('done')" :key="task.id">
                                    <div class="task-card p-4 rounded-lg cursor-pointer opacity-75 border-l-4 border-success"
                                         @click="selectTask(task)">
                                        <div class="flex items-start justify-between">
                                            <div class="flex-1">
                                                <h4 class="font-medium text-base line-through" x-text="task.title"></h4>
                                                <p class="text-sm text-gray-600 dark:text-gray-400 mt-1" x-text="task.description"></p>
                                                <div class="flex items-center justify-between mt-3">
                                                    <span :class="getPriorityColor(task.priority)" 
                                                          class="px-2 py-1 rounded-full text-xs font-medium" 
                                                          x-text="getPriorityText(task.priority)"></span>
                                                    <div class="flex space-x-2">
                                                        <button @click.stop="changeTaskStatus(task, 'doing')" 
                                                                class="btn-3d btn-3d-warning text-white p-1 rounded transition-all"
                                                                title="ทำงานต่อ">
                                                            <i class="fas fa-undo text-xs"></i>
                                                        </button>
                                                        <span class="text-success">
                                                            <i class="fas fa-check-circle text-lg"></i>
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </template>
                                <div x-show="getFilteredTasks('done').length === 0" class="text-center py-8 text-gray-500">
                                    <i class="fas fa-trophy text-3xl mb-3 opacity-50"></i>
                                    <p>ยังไม่มีงานที่เสร็จ</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Media View -->
                <div x-show="currentView === 'media'" class="fade-in space-y-6">
                    <div class="flex items-center justify-between">
                        <h3 class="text-2xl font-bold bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent">สื่อมัลติมีเดีย</h3>
                        <button @click="showMediaAdd = true" 
                                class="btn-3d btn-3d-primary text-white px-4 py-2 rounded-lg transition-all">
                            <i class="fas fa-plus mr-2"></i>
                            เพิ่มสื่อใหม่
                        </button>
                    </div>

                    <!-- Media Filter -->
                    <div class="glass rounded-xl p-4">
                        <div class="flex flex-wrap items-center gap-4">
                            <button @click="mediaFilter = 'all'" 
                                    :class="mediaFilter === 'all' ? 'btn-3d-primary text-white' : 'btn-3d text-gray-700 dark:text-gray-300'"
                                    class="px-4 py-2 rounded-lg transition-all">
                                ทั้งหมด
                            </button>
                            <button @click="mediaFilter = 'youtube'" 
                                    :class="mediaFilter === 'youtube' ? 'btn-3d-error text-white' : 'btn-3d text-gray-700 dark:text-gray-300'"
                                    class="px-4 py-2 rounded-lg transition-all">
                                <i class="fab fa-youtube mr-2"></i>
                                YouTube
                            </button>
                            <button @click="mediaFilter = 'spotify'" 
                                    :class="mediaFilter === 'spotify' ? 'btn-3d-success text-white' : 'btn-3d text-gray-700 dark:text-gray-300'"
                                    class="px-4 py-2 rounded-lg transition-all">
                                <i class="fab fa-spotify mr-2"></i>
                                Spotify
                            </button>
                            <button @click="mediaFilter = 'podcast'" 
                                    :class="mediaFilter === 'podcast' ? 'btn-3d-secondary text-white' : 'btn-3d text-gray-700 dark:text-gray-300'"
                                    class="px-4 py-2 rounded-lg transition-all">
                                <i class="fas fa-podcast mr-2"></i>
                                Podcast
                            </button>
                        </div>
                    </div>

                    <!-- Media Grid -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <template x-for="media in getFilteredMedia()" :key="media.id">
                            <div class="gallery-item glass p-4">
                                <div class="aspect-video bg-gray-200 dark:bg-gray-700 rounded-lg mb-3 flex items-center justify-center overflow-hidden">
                                    <div x-show="media.type === 'youtube'" class="w-full h-full">
                                        <iframe :src="getYouTubeEmbedUrl(media.url)" 
                                                class="w-full h-full rounded-lg"
                                                frameborder="0" allowfullscreen></iframe>
                                    </div>
                                    <div x-show="media.type === 'spotify'" class="w-full h-full">
                                        <iframe :src="getSpotifyEmbedUrl(media.url)" 
                                                class="w-full h-full rounded-lg"
                                                frameborder="0" allowtransparency="true"></iframe>
                                    </div>
                                    <div x-show="media.type === 'podcast'" class="text-center">
                                        <i class="fas fa-podcast text-4xl text-secondary mb-2"></i>
                                        <p class="text-sm text-gray-600 dark:text-gray-400">Podcast</p>
                                    </div>
                                </div>
                                <h4 class="font-semibold mb-2" x-text="media.title"></h4>
                                <p class="text-sm text-gray-600 dark:text-gray-400 mb-3" x-text="media.description"></p>
                                <div class="flex items-center justify-between">
                                    <span :class="media.type === 'youtube' ? 'bg-red-100 text-red-600 dark:bg-red-900/20' : media.type === 'spotify' ? 'bg-green-100 text-green-600 dark:bg-green-900/20' : 'bg-purple-100 text-purple-600 dark:bg-purple-900/20'"
                                          class="px-2 py-1 rounded-full text-xs font-medium">
                                        <i :class="media.type === 'youtube' ? 'fab fa-youtube' : media.type === 'spotify' ? 'fab fa-spotify' : 'fas fa-podcast'" class="mr-1"></i>
                                        <span x-text="media.type.toUpperCase()"></span>
                                    </span>
                                    <div class="flex space-x-2">
                                        <button @click="playMedia(media)" 
                                                class="btn-3d btn-3d-primary text-white p-2 rounded transition-all">
                                            <i class="fas fa-play text-sm"></i>
                                        </button>
                                        <button @click="removeMedia(media.id)" 
                                                class="btn-3d btn-3d-error text-white p-2 rounded transition-all">
                                            <i class="fas fa-trash text-sm"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </template>
                    </div>

                    <div x-show="getFilteredMedia().length === 0" class="text-center py-12">
                        <i class="fas fa-play-circle text-6xl text-gray-400 mb-4"></i>
                        <h3 class="text-xl font-semibold mb-2">ยังไม่มีสื่อมัลติมีเดีย</h3>
                        <p class="text-gray-600 dark:text-gray-400 mb-4">เริ่มเพิ่มวิดีโอ, เพลง หรือพอดแคสต์ที่คุณชอบ</p>
                        <button @click="showMediaAdd = true" 
                                class="btn-3d btn-3d-primary text-white px-6 py-3 rounded-lg transition-all">
                            <i class="fas fa-plus mr-2"></i>
                            เพิ่มสื่อแรก
                        </button>
                    </div>
                </div>

                <!-- Gallery View -->
                <div x-show="currentView === 'gallery'" class="fade-in space-y-6">
                    <div class="flex items-center justify-between">
                        <h3 class="text-2xl font-bold bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent">แกลเลอรี่</h3>
                        <button @click="addToGallery()" 
                                class="btn-3d btn-3d-primary text-white px-4 py-2 rounded-lg transition-all">
                            <i class="fas fa-plus mr-2"></i>
                            เพิ่มรูปภาพ
                        </button>
                    </div>

                    <div class="gallery-grid">
                        <template x-for="item in galleryItems" :key="item.id">
                            <div class="gallery-item">
                                <div class="aspect-square bg-gray-200 dark:bg-gray-700 rounded-lg overflow-hidden">
                                    <img :src="item.url" :alt="item.title" class="w-full h-full object-cover">
                                </div>
                                <div class="p-4">
                                    <h4 class="font-semibold mb-2" x-text="item.title"></h4>
                                    <p class="text-sm text-gray-600 dark:text-gray-400 mb-3" x-text="item.description"></p>
                                    <div class="flex items-center justify-between">
                                        <span class="text-xs text-gray-500" x-text="formatDate(item.createdAt)"></span>
                                        <div class="flex space-x-2">
                                            <button @click="viewImage(item)" 
                                                    class="btn-3d btn-3d-primary text-white p-2 rounded transition-all">
                                                <i class="fas fa-eye text-sm"></i>
                                            </button>
                                            <button @click="removeFromGallery(item.id)" 
                                                    class="btn-3d btn-3d-error text-white p-2 rounded transition-all">
                                                <i class="fas fa-trash text-sm"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </template>
                    </div>

                    <div x-show="galleryItems.length === 0" class="text-center py-12">
                        <i class="fas fa-images text-6xl text-gray-400 mb-4"></i>
                        <h3 class="text-xl font-semibold mb-2">แกลเลอรี่ว่างเปล่า</h3>
                        <p class="text-gray-600 dark:text-gray-400 mb-4">เริ่มเพิ่มรูปภาพที่สวยงาม</p>
                        <button @click="addToGallery()" 
                                class="btn-3d btn-3d-primary text-white px-6 py-3 rounded-lg transition-all">
                            <i class="fas fa-plus mr-2"></i>
                            เพิ่มรูปแรก
                        </button>
                    </div>
                </div>

                <!-- API Connections View -->
                <div x-show="currentView === 'api'" class="fade-in space-y-6">
                    <h3 class="text-2xl font-bold bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent">การเชื่อมต่อ API</h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Poe AI -->
                        <div class="glass rounded-xl p-6">
                            <div class="flex items-center justify-between mb-4">
                                <div class="flex items-center">
                                    <div :class="window.Poe ? 'bg-success/20' : 'bg-error/20'" class="p-3 rounded-lg mr-4">
                                        <i class="fas fa-robot text-2xl" :class="window.Poe ? 'text-success' : 'text-error'"></i>
                                    </div>
                                    <div>
                                        <h4 class="font-semibold">Poe AI</h4>
                                        <p class="text-sm text-gray-600 dark:text-gray-400">ระบบปัญญาประดิษฐ์</p>
                                    </div>
                                </div>
                                <span :class="window.Poe ? 'bg-success/20 text-success' : 'bg-error/20 text-error'" 
                                      class="px-3 py-1 rounded-full text-sm font-medium">
                                    <span x-text="window.Poe ? 'เชื่อมต่อแล้ว' : 'ไม่เชื่อมต่อ'"></span>
                                </span>
                            </div>
                            <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">
                                ใช้สำหรับขอคำแนะนำและวิเคราะห์อารมณ์
                            </p>
                            <button @click="testAIConnection()" 
                                    :disabled="!window.Poe"
                                    class="btn-3d btn-3d-primary text-white px-4 py-2 rounded-lg transition-all disabled:opacity-50">
                                <i class="fas fa-test mr-2"></i>
                                ทดสอบการเชื่อมต่อ
                            </button>
                        </div>

                        <!-- YouTube API -->
                        <div class="glass rounded-xl p-6">
                            <div class="flex items-center justify-between mb-4">
                                <div class="flex items-center">
                                    <div :class="apiConnections.youtube ? 'bg-success/20' : 'bg-error/20'" class="p-3 rounded-lg mr-4">
                                        <i class="fab fa-youtube text-2xl" :class="apiConnections.youtube ? 'text-success' : 'text-error'"></i>
                                    </div>
                                    <div>
                                        <h4 class="font-semibold">YouTube API</h4>
                                        <p class="text-sm text-gray-600 dark:text-gray-400">วิดีโอและพอดแคสต์</p>
                                    </div>
                                </div>
                                <span :class="apiConnections.youtube ? 'bg-success/20 text-success' : 'bg-error/20 text-error'" 
                                      class="px-3 py-1 rounded-full text-sm font-medium">
                                    <span x-text="apiConnections.youtube ? 'เชื่อมต่อแล้ว' : 'ไม่เชื่อมต่อ'"></span>
                                </span>
                            </div>
                            <div class="space-y-3">
                                <input x-model="apiKeys.youtube" 
                                       type="password" 
                                       placeholder="YouTube API Key"
                                       class="w-full p-3 border border-gray-300/50 dark:border-gray-600/50 rounded-lg bg-white/50 dark:bg-gray-700/50 text-base">
                                <button @click="connectYouTube()" 
                                        :disabled="!apiKeys.youtube.trim()"
                                        class="btn-3d btn-3d-error text-white px-4 py-2 rounded-lg transition-all disabled:opacity-50">
                                    <i class="fab fa-youtube mr-2"></i>
                                    เชื่อมต่อ YouTube
                                </button>
                            </div>
                        </div>

                        <!-- Spotify API -->
                        <div class="glass rounded-xl p-6">
                            <div class="flex items-center justify-between mb-4">
                                <div class="flex items-center">
                                    <div :class="apiConnections.spotify ? 'bg-success/20' : 'bg-error/20'" class="p-3 rounded-lg mr-4">
                                        <i class="fab fa-spotify text-2xl" :class="apiConnections.spotify ? 'text-success' : 'text-error'"></i>
                                    </div>
                                    <div>
                                        <h4 class="font-semibold">Spotify API</h4>
                                        <p class="text-sm text-gray-600 dark:text-gray-400">เพลงและพอดแคสต์</p>
                                    </div>
                                </div>
                                <span :class="apiConnections.spotify ? 'bg-success/20 text-success' : 'bg-error/20 text-error'" 
                                      class="px-3 py-1 rounded-full text-sm font-medium">
                                    <span x-text="apiConnections.spotify ? 'เชื่อมต่อแล้ว' : 'ไม่เชื่อมต่อ'"></span>
                                </span>
                            </div>
                            <div class="space-y-3">
                                <input x-model="apiKeys.spotify" 
                                       type="password" 
                                       placeholder="Spotify Client ID"
                                       class="w-full p-3 border border-gray-300/50 dark:border-gray-600/50 rounded-lg bg-white/50 dark:bg-gray-700/50 text-base">
                                <button @click="connectSpotify()" 
                                        :disabled="!apiKeys.spotify.trim()"
                                        class="btn-3d btn-3d-success text-white px-4 py-2 rounded-lg transition-all disabled:opacity-50">
                                    <i class="fab fa-spotify mr-2"></i>
                                    เชื่อมต่อ Spotify
                                </button>
                            </div>
                        </div>

                        <!-- Notion API -->
                        <div class="glass rounded-xl p-6">
                            <div class="flex items-center justify-between mb-4">
                                <div class="flex items-center">
                                    <div :class="notionConnected ? 'bg-success/20' : 'bg-error/20'" class="p-3 rounded-lg mr-4">
                                        <i class="fab fa-notion text-2xl" :class="notionConnected ? 'text-success' : 'text-error'"></i>
                                    </div>
                                    <div>
                                        <h4 class="font-semibold">Notion API</h4>
                                        <p class="text-sm text-gray-600 dark:text-gray-400">ฐานข้อมูลและบันทึก</p>
                                    </div>
                                </div>
                                <span :class="notionConnected ? 'bg-success/20 text-success' : 'bg-error/20 text-error'" 
                                      class="px-3 py-1 rounded-full text-sm font-medium">
                                    <span x-text="notionConnected ? 'เชื่อมต่อแล้ว' : 'ไม่เชื่อมต่อ'"></span>
                                </span>
                            </div>
                            <div class="space-y-3">
                                <input x-model="notionToken" 
                                       type="password" 
                                       placeholder="Notion Integration Token"
                                       class="w-full p-3 border border-gray-300/50 dark:border-gray-600/50 rounded-lg bg-white/50 dark:bg-gray-700/50 text-base">
                                <input x-model="notionDatabaseId" 
                                       type="text" 
                                       placeholder="Database ID"
                                       class="w-full p-3 border border-gray-300/50 dark:border-gray-600/50 rounded-lg bg-white/50 dark:bg-gray-700/50 text-base">
                                <button @click="connectNotion()" 
                                        :disabled="!notionToken.trim() || !notionDatabaseId.trim()"
                                        class="btn-3d text-gray-700 dark:text-gray-300 px-4 py-2 rounded-lg transition-all disabled:opacity-50">
                                    <i class="fab fa-notion mr-2"></i>
                                    เชื่อมต่อ Notion
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Mood View -->
                <div x-show="currentView === 'mood'" class="fade-in">
                    <div class="max-w-4xl mx-auto space-y-6">
                        <div class="glass rounded-xl p-8">
                            <h3 class="text-2xl font-semibold mb-6 text-center bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent">อารมณ์ของคุณวันนี้เป็นอย่างไร?</h3>
                            
                            <!-- Mood Selection -->
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
                                <template x-for="mood in moods" :key="mood.id">
                                    <button @click="selectMood(mood)" 
                                            :class="currentMood?.id === mood.id ? 'mood-button active btn-3d-primary text-white' : 'mood-button btn-3d'"
                                            class="p-6 rounded-xl text-center transition-all duration-300">
                                        <div class="text-4xl mb-2" x-text="mood.emoji"></div>
                                        <div class="font-medium text-base" x-text="mood.name"></div>
                                        <div class="text-sm opacity-75 mt-1" x-text="mood.description"></div>
                                    </button>
                                </template>
                            </div>

                            <!-- Current Mood Info -->
                            <div x-show="currentMood" class="glass rounded-xl p-6 text-center">
                                <div class="text-6xl mb-4 animate-bounce-slow" x-text="currentMood?.emoji"></div>
                                <h4 class="text-xl font-semibold mb-2" x-text="currentMood?.name"></h4>
                                <p class="text-gray-600 dark:text-gray-400 mb-4" x-text="currentMood?.description"></p>
                                <div class="flex justify-center space-x-4">
                                    <button @click="getAIRecommendations()" 
                                            :disabled="aiLoading || !window.Poe"
                                            class="btn-3d btn-3d-primary text-white px-6 py-3 rounded-lg transition-all disabled:opacity-50">
                                        <i :class="aiLoading ? 'fas fa-spinner fa-spin' : 'fas fa-robot'" class="mr-2"></i>
                                        <span x-text="aiLoading ? 'กำลังวิเคราะห์...' : !window.Poe ? 'AI ไม่พร้อมใช้งาน' : 'ขอคำแนะนำจาก AI'"></span>
                                    </button>
                                    <button @click="saveMoodLog()" 
                                            class="btn-3d btn-3d-secondary text-white px-6 py-3 rounded-lg transition-all">
                                        <i class="fas fa-save mr-2"></i>
                                        บันทึกอารมณ์
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- AI Recommendations -->
                        <div x-show="aiRecommendations" class="glass rounded-xl p-6">
                            <h4 class="text-lg font-semibold mb-4 flex items-center">
                                <i class="fas fa-robot text-primary mr-2"></i>
                                คำแนะนำจาก AI
                            </h4>
                            <div class="prose dark:prose-invert max-w-none">
                                <div x-html="aiRecommendations"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- AI View -->
                <div x-show="currentView === 'ai'" class="fade-in">
                    <div class="max-w-4xl mx-auto space-y-6">
                        <div class="glass rounded-xl p-6">
                            <h3 class="text-xl font-semibold mb-4 flex items-center">
                                <i class="fas fa-robot text-primary mr-3"></i>
                                AI ผู้ช่วยวางแผนงาน
                            </h3>
                            
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium mb-2">บอก AI ว่าคุณต้องการอะไร:</label>
                                    <textarea x-model="aiPrompt" 
                                              placeholder="เช่น วางแผนการเรียนภาษาอังกฤษ, จัดระเบียบงานบ้าน, หาแรงบันดาลใจในการทำงาน..."
                                              class="w-full p-4 border border-gray-300/50 dark:border-gray-600/50 rounded-lg glass resize-none text-base"
                                              rows="4"></textarea>
                                </div>
                                
                                <div class="flex flex-wrap gap-2">
                                    <button @click="setQuickPrompt('ช่วยวางแผนการเรียนรู้ทักษะใหม่')"
                                            class="btn-3d px-3 py-2 rounded-lg text-sm">
                                        วางแผนเรียนรู้
                                    </button>
                                    <button @click="setQuickPrompt('แนะนำการจัดระเบียบงานประจำวัน')"
                                            class="btn-3d px-3 py-2 rounded-lg text-sm">
                                        จัดระเบียบงาน
                                    </button>
                                    <button @click="setQuickPrompt('ช่วยหาแรงบันดาลใจในการทำงาน')"
                                            class="btn-3d px-3 py-2 rounded-lg text-sm">
                                        หาแรงบันดาลใจ
                                    </button>
                                    <button @click="setQuickPrompt('วางแผนการออกกำลังกายและดูแลสุขภาพ')"
                                            class="btn-3d px-3 py-2 rounded-lg text-sm">
                                        ดูแลสุขภาพ
                                    </button>
                                </div>
                                
                                <button @click="getCustomAIAdvice()" 
                                        :disabled="aiLoading || !aiPrompt.trim() || !window.Poe"
                                        class="w-full btn-3d btn-3d-primary text-white py-3 rounded-lg transition-all disabled:opacity-50">
                                    <i :class="aiLoading ? 'fas fa-spinner fa-spin' : 'fas fa-magic'" class="mr-2"></i>
                                    <span x-text="aiLoading ? 'AI กำลังคิด...' : !window.Poe ? 'AI ไม่พร้อมใช้งาน' : 'ขอคำแนะนำจาก AI'"></span>
                                </button>
                            </div>
                        </div>

                        <!-- AI Response -->
                        <div x-show="aiResponse" class="glass rounded-xl p-6">
                            <h4 class="text-lg font-semibold mb-4 flex items-center">
                                <i class="fas fa-lightbulb text-warning mr-2"></i>
                                คำแนะนำจาก AI
                            </h4>
                            <div class="prose dark:prose-invert max-w-none">
                                <div x-html="aiResponse"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>

        <!-- Quick Add Modal -->
        <div x-show="showQuickAdd" 
             x-transition:enter="transition ease-out duration-300"
             x-transition:enter-start="opacity-0"
             x-transition:enter-end="opacity-100"
             x-transition:leave="transition ease-in duration-200"
             x-transition:leave-start="opacity-100"
             x-transition:leave-end="opacity-0"
             class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4">
            <div x-show="showQuickAdd"
                 x-transition:enter="transition ease-out duration-300"
                 x-transition:enter-start="opacity-0 scale-95"
                 x-transition:enter-end="opacity-100 scale-100"
                 x-transition:leave="transition ease-in duration-200"
                 x-transition:leave-start="opacity-100 scale-100"
                 x-transition:leave-end="opacity-0 scale-95"
                 @click.away="showQuickAdd = false"
                 class="glass rounded-xl p-6 w-full max-w-md shadow-2xl">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold">เพิ่มงานใหม่</h3>
                    <button @click="showQuickAdd = false" class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 btn-3d p-2 rounded">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <form @submit.prevent="addTask()" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">ชื่องาน:</label>
                        <input x-model="newTask.title" 
                               type="text" 
                               placeholder="เช่น เรียนภาษาอังกฤษ"
                               class="w-full p-3 border border-gray-300/50 dark:border-gray-600/50 rounded-lg glass text-base"
                               required>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-2">รายละเอียด:</label>
                        <textarea x-model="newTask.description" 
                                  placeholder="รายละเอียดเพิ่มเติม..."
                                  class="w-full p-3 border border-gray-300/50 dark:border-gray-600/50 rounded-lg glass resize-none text-base"
                                  rows="3"></textarea>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">ความสำคัญ:</label>
                            <select x-model="newTask.priority" 
                                    class="w-full p-3 border border-gray-300/50 dark:border-gray-600/50 rounded-lg glass text-base">
                                <option value="low">ต่ำ</option>
                                <option value="medium">กลาง</option>
                                <option value="high">สูง</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium mb-2">สถานะ:</label>
                            <select x-model="newTask.status" 
                                    class="w-full p-3 border border-gray-300/50 dark:border-gray-600/50 rounded-lg glass text-base">
                                <option value="todo">รอทำ</option>
                                <option value="doing">กำลังทำ</option>
                                <option value="done">เสร็จแล้ว</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Add Subtask -->
                    <div>
                        <label class="block text-sm font-medium mb-2">งานย่อย:</label>
                        <div class="space-y-2">
                            <template x-for="(subtask, index) in newTask.subtasks" :key="index">
                                <div class="flex items-center space-x-2">
                                    <input x-model="subtask.title" 
                                           type="text" 
                                           placeholder="งานย่อย..."
                                           class="flex-1 p-2 border border-gray-300/50 dark:border-gray-600/50 rounded-lg glass text-base">
                                    <button type="button" @click="removeSubtask(index)" 
                                            class="btn-3d btn-3d-error text-white p-2 rounded">
                                        <i class="fas fa-trash text-sm"></i>
                                    </button>
                                </div>
                            </template>
                            <button type="button" @click="addSubtask()" 
                                    class="w-full p-2 border-2 border-dashed border-gray-300/50 dark:border-gray-600/50 rounded-lg text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 transition-colors btn-3d">
                                <i class="fas fa-plus mr-2"></i>
                                เพิ่มงานย่อย
                            </button>
                        </div>
                    </div>
                    
                    <div class="flex items-center space-x-4 pt-4">
                        <button type="submit" 
                                class="flex-1 btn-3d btn-3d-primary text-white py-3 rounded-lg transition-all">
                            <i class="fas fa-plus mr-2"></i>
                            เพิ่มงาน
                        </button>
                        <button type="button" 
                                @click="showQuickAdd = false"
                                class="px-6 py-3 btn-3d rounded-lg transition-all">
                            ยกเลิก
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Media Add Modal -->
        <div x-show="showMediaAdd" 
             x-transition:enter="transition ease-out duration-300"
             x-transition:enter-start="opacity-0"
             x-transition:enter-end="opacity-100"
             x-transition:leave="transition ease-in duration-200"
             x-transition:leave-start="opacity-100"
             x-transition:leave-end="opacity-0"
             class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4">
            <div x-show="showMediaAdd"
                 x-transition:enter="transition ease-out duration-300"
                 x-transition:enter-start="opacity-0 scale-95"
                 x-transition:enter-end="opacity-100 scale-100"
                 x-transition:leave="transition ease-in duration-200"
                 x-transition:leave-start="opacity-100 scale-100"
                 x-transition:leave-end="opacity-0 scale-95"
                 @click.away="showMediaAdd = false"
                 class="glass rounded-xl p-6 w-full max-w-md shadow-2xl">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold">เพิ่มสื่อมัลติมีเดีย</h3>
                    <button @click="showMediaAdd = false" class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 btn-3d p-2 rounded">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <form @submit.prevent="addMedia()" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">ชื่อสื่อ:</label>
                        <input x-model="newMedia.title" 
                               type="text" 
                               placeholder="เช่น บทเรียนภาษาอังกฤษ"
                               class="w-full p-3 border border-gray-300/50 dark:border-gray-600/50 rounded-lg glass text-base"
                               required>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-2">ประเภท:</label>
                        <select x-model="newMedia.type" 
                                class="w-full p-3 border border-gray-300/50 dark:border-gray-600/50 rounded-lg glass text-base">
                            <option value="youtube">YouTube Video</option>
                            <option value="spotify">Spotify Playlist/Track</option>
                            <option value="podcast">Podcast</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-2">URL:</label>
                        <input x-model="newMedia.url" 
                               type="url" 
                               placeholder="https://..."
                               class="w-full p-3 border border-gray-300/50 dark:border-gray-600/50 rounded-lg glass text-base"
                               required>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-2">คำอธิบาย:</label>
                        <textarea x-model="newMedia.description" 
                                  placeholder="รายละเอียดสื่อ..."
                                  class="w-full p-3 border border-gray-300/50 dark:border-gray-600/50 rounded-lg glass resize-none text-base"
                                  rows="3"></textarea>
                    </div>
                    
                    <div class="flex items-center space-x-4 pt-4">
                        <button type="submit" 
                                class="flex-1 btn-3d btn-3d-primary text-white py-3 rounded-lg transition-all">
                            <i class="fas fa-plus mr-2"></i>
                            เพิ่มสื่อ
                        </button>
                        <button type="button" 
                                @click="showMediaAdd = false"
                                class="px-6 py-3 btn-3d rounded-lg transition-all">
                            ยกเลิก
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Floating Action Button (Mobile) -->
        <button @click="showQuickAdd = true" 
                class="floating-add md:hidden btn-3d btn-3d-primary text-white w-14 h-14 rounded-full shadow-lg flex items-center justify-center">
            <i class="fas fa-plus text-xl"></i>
        </button>
    </div>

    <script>
        // Dark mode detection
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });

        function ashvalApp() {
            return {
                // State
                currentView: 'dashboard',
                isDark: window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches,
                sidebarCollapsed: window.innerWidth < 768,
                showQuickAdd: false,
                showMediaAdd: false,
                currentMood: null,
                tasks: [],
                mediaItems: [],
                galleryItems: [],
                moodHistory: [],
                taskFilter: {
                    status: '',
                    priority: ''
                },
                mediaFilter: 'all',
                
                // API Connections
                apiConnections: {
                    youtube: false,
                    spotify: false,
                    notion: false
                },
                
                apiKeys: {
                    youtube: '',
                    spotify: '',
                    notion: ''
                },
                
                // Notification system
                notification: {
                    show: false,
                    message: '',
                    type: 'info'
                },
                
                // AI related
                aiLoading: false,
                aiRecommendations: '',
                aiResponse: '',
                aiPrompt: '',
                
                // Notion related
                notionConnected: false,
                notionToken: '',
                notionDatabaseId: '',
                notionLoading: false,
                
                // New task form
                newTask: {
                    title: '',
                    description: '',
                    priority: 'medium',
                    status: 'todo',
                    subtasks: []
                },

                // New media form
                newMedia: {
                    title: '',
                    type: 'youtube',
                    url: '',
                    description: ''
                },
                
                // Sample data
                moods: [
                    { id: 1, name: 'มีความสุข', emoji: '😊', description: 'รู้สึกดีและมีพลัง' },
                    { id: 2, name: 'เครียด', emoji: '😰', description: 'รู้สึกกดดันและวิตกกังวล' },
                    { id: 3, name: 'เบื่อ', emoji: '😑', description: 'รู้สึกไม่มีแรงบันดาลใจ' },
                    { id: 4, name: 'โฟกัส', emoji: '🎯', description: 'พร้อมทำงานและมีสมาธิ' },
                    { id: 5, name: 'เศร้า', emoji: '😢', description: 'รู้สึกหดหู่และไม่มีแรง' },
                    { id: 6, name: 'ตื่นเต้น', emoji: '🤗', description: 'มีพลังและอยากลองสิ่งใหม่' },
                    { id: 7, name: 'เหนื่อย', emoji: '😴', description: 'รู้สึกอ่อนล้าและต้องการพักผ่อน' },
                    { id: 8, name: 'สบายใจ', emoji: '😌', description: 'รู้สึกสงบและผ่อนคลาย' }
                ],

                init() {
                    // Load data from localStorage
                    this.loadDataFromStorage();
                    
                    // Initialize sample data if no data exists
                    if (this.tasks.length === 0) {
                        this.initializeSampleData();
                    }

                    // Register Poe API handlers
                    if (window.Poe && window.Poe.registerHandler) {
                        window.Poe.registerHandler("mood-recommendation", (result) => {
                            this.handleAIResponse(result, 'recommendations');
                        });

                        window.Poe.registerHandler("custom-advice", (result) => {
                            this.handleAIResponse(result, 'advice');
                        });
                    }

                    // Auto-save data every 30 seconds
                    setInterval(() => {
                        this.saveDataToStorage();
                    }, 30000);

                    // Handle window resize
                    window.addEventListener('resize', () => {
                        if (window.innerWidth < 768) {
                            this.sidebarCollapsed = true;
                        }
                    });
                },

                // Sidebar management
                toggleSidebar() {
                    this.sidebarCollapsed = !this.sidebarCollapsed;
                },

                // Data persistence
                loadDataFromStorage() {
                    try {
                        const savedData = localStorage.getItem('ashval-data');
                        if (savedData) {
                            const data = JSON.parse(savedData);
                            this.tasks = data.tasks || [];
                            this.mediaItems = data.mediaItems || [];
                            this.galleryItems = data.galleryItems || [];
                            this.currentMood = data.currentMood || null;
                            this.moodHistory = data.moodHistory || [];
                            this.taskFilter = data.taskFilter || { status: '', priority: '' };
                            this.apiConnections = data.apiConnections || { youtube: false, spotify: false, notion: false };
                            this.notionConnected = data.notionConnected || false;
                            this.notionToken = data.notionToken || '';
                            this.notionDatabaseId = data.notionDatabaseId || '';
                        }
                    } catch (error) {
                        console.error('Error loading data from localStorage:', error);
                        this.showNotification('เกิดข้อผิดพลาดในการโหลดข้อมูล', 'error');
                    }
                },

                saveDataToStorage() {
                    try {
                        const dataToSave = {
                            tasks: this.tasks,
                            mediaItems: this.mediaItems,
                            galleryItems: this.galleryItems,
                            currentMood: this.currentMood,
                            moodHistory: this.moodHistory,
                            taskFilter: this.taskFilter,
                            apiConnections: this.apiConnections,
                            notionConnected: this.notionConnected,
                            notionToken: this.notionToken,
                            notionDatabaseId: this.notionDatabaseId
                        };
                        localStorage.setItem('ashval-data', JSON.stringify(dataToSave));
                    } catch (error) {
                        console.error('Error saving data to localStorage:', error);
                        this.showNotification('เกิดข้อผิดพลาดในการบันทึกข้อมูล', 'error');
                    }
                },

                saveSettings() {
                    this.saveDataToStorage();
                },

                initializeSampleData() {
                    this.tasks = [
                        {
                            id: 1,
                            title: 'เรียนภาษาอังกฤษ',
                            description: 'อ่านหนังสือและฝึกฟัง 30 นาที',
                            status: 'doing',
                            priority: 'high',
                            completed: false,
                            createdAt: new Date('2024-01-15'),
                            subtasks: [
                                { id: 11, title: 'อ่านบทความภาษาอังกฤษ', completed: true },
                                { id: 12, title: 'ฟังพอดแคสต์ 15 นาที', completed: false }
                            ]
                        },
                        {
                            id: 2,
                            title: 'ออกกำลังกาย',
                            description: 'วิ่งเบาๆ 20 นาที',
                            status: 'todo',
                            priority: 'medium',
                            completed: false,
                            createdAt: new Date('2024-01-14'),
                            subtasks: []
                        }
                    ];

                    this.mediaItems = [
                        {
                            id: 1,
                            title: 'English Learning Podcast',
                            type: 'youtube',
                            url: 'https://www.youtube.com/watch?v=dQw4w9WgXcQ',
                            description: 'บทเรียนภาษาอังกฤษเบื้องต้น',
                            createdAt: new Date()
                        }
                    ];

                    this.galleryItems = [
                        {
                            id: 1,
                            title: 'แรงบันดาลใจ',
                            url: 'https://picsum.photos/400/400?random=1',
                            description: 'รูปภาพสวยงาม',
                            createdAt: new Date()
                        }
                    ];

                    this.saveDataToStorage();
                },

                // Notification system
                showNotification(message, type = 'info') {
                    this.notification = {
                        show: true,
                        message: message,
                        type: type
                    };
                    
                    setTimeout(() => {
                        this.hideNotification();
                    }, 5000);
                },

                hideNotification() {
                    this.notification.show = false;
                },

                // View management
                getViewTitle() {
                    const titles = {
                        dashboard: 'แดชบอร์ด',
                        tasks: 'งานทั้งหมด',
                        mood: 'อารมณ์วันนี้',
                        ai: 'AI ผู้ช่วย',
                        media: 'สื่อมัลติมีเดีย',
                        gallery: 'แกลเลอรี่',
                        api: 'การเชื่อมต่อ API'
                    };
                    return titles[this.currentView] || 'Ashval Pro';
                },

                getCurrentDateTime() {
                    return new Date().toLocaleDateString('th-TH', {
                        weekday: 'long',
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric'
                    });
                },

                toggleDarkMode() {
                    this.isDark = !this.isDark;
                    if (this.isDark) {
                        document.documentElement.classList.add('dark');
                    } else {
                        document.documentElement.classList.remove('dark');
                    }
                },

                // API Management
                getConnectedAPIs() {
                    return Object.values(this.apiConnections).filter(Boolean).length;
                },

                testAIConnection() {
                    if (window.Poe) {
                        this.showNotification('AI เชื่อมต่อพร้อมใช้งาน', 'success');
                    } else {
                        this.showNotification('AI ไม่พร้อมใช้งาน', 'error');
                    }
                },

                connectYouTube() {
                    // Simulate YouTube API connection
                    this.apiConnections.youtube = true;
                    this.saveDataToStorage();
                    this.showNotification('เชื่อมต่อ YouTube API สำเร็จ', 'success');
                },

                connectSpotify() {
                    // Simulate Spotify API connection
                    this.apiConnections.spotify = true;
                    this.saveDataToStorage();
                    this.showNotification('เชื่อมต่อ Spotify API สำเร็จ', 'success');
                },

                connectNotion() {
                    if (!this.notionToken.trim() || !this.notionDatabaseId.trim()) {
                        this.showNotification('กรุณาใส่ Token และ Database ID', 'error');
                        return;
                    }
                    
                    this.notionLoading = true;
                    
                    setTimeout(() => {
                        this.notionConnected = true;
                        this.notionLoading = false;
                        this.apiConnections.notion = true;
                        this.saveDataToStorage();
                        this.showNotification('เชื่อมต่อ Notion API สำเร็จ', 'success');
                    }, 2000);
                },

                // Task management
                getTotalTasks() {
                    return this.tasks.length;
                },

                getCompletedTasks() {
                    return this.tasks.filter(task => task.status === 'done').length;
                },

                getInProgressTasks() {
                    return this.tasks.filter(task => task.status === 'doing').length;
                },

                getRecentTasks() {
                    return this.tasks
                        .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))
                        .slice(0, 5);
                },

                getFilteredTasks(status) {
                    let filtered = this.tasks.filter(task => task.status === status);
                    
                    if (this.taskFilter.priority) {
                        filtered = filtered.filter(task => task.priority === this.taskFilter.priority);
                    }
                    
                    return filtered;
                },

                clearFilters() {
                    this.taskFilter = { status: '', priority: '' };
                    this.saveSettings();
                },

                selectTask(task) {
                    console.log('Selected task:', task);
                },

                toggleTaskComplete(task) {
                    task.completed = !task.completed;
                    task.status = task.completed ? 'done' : task.status;
                    this.saveDataToStorage();
                    this.showNotification(
                        task.completed ? `เสร็จสิ้นงาน: ${task.title}` : `ยกเลิกการทำเสร็จ: ${task.title}`,
                        'success'
                    );
                },

                changeTaskStatus(task, newStatus) {
                    const oldStatus = task.status;
                    task.status = newStatus;
                    task.completed = newStatus === 'done';
                    this.saveDataToStorage();
                    
                    const statusTexts = {
                        todo: 'รอทำ',
                        doing: 'กำลังทำ',
                        done: 'เสร็จแล้ว'
                    };
                    
                    this.showNotification(
                        `เปลี่ยนสถานะงาน "${task.title}" จาก ${statusTexts[oldStatus]} เป็น ${statusTexts[newStatus]}`,
                        'success'
                    );
                },

                toggleSubtaskComplete(task, subtask) {
                    subtask.completed = !subtask.completed;
                    this.saveDataToStorage();
                },

                getCompletedSubtasks(task) {
                    if (!task.subtasks) return 0;
                    return task.subtasks.filter(s => s.completed).length;
                },

                addTask() {
                    const newId = Math.max(...this.tasks.map(t => t.id), 0) + 1;
                    const task = {
                        id: newId,
                        title: this.newTask.title,
                        description: this.newTask.description,
                        status: this.newTask.status,
                        priority: this.newTask.priority,
                        completed: this.newTask.status === 'done',
                        createdAt: new Date(),
                        subtasks: this.newTask.subtasks.filter(s => s.title.trim()).map((s, index) => ({
                            id: newId * 100 + index + 1,
                            title: s.title,
                            completed: false
                        }))
                    };
                    
                    this.tasks.push(task);
                    this.saveDataToStorage();
                    this.resetNewTask();
                    this.showQuickAdd = false;
                    this.showNotification(`เพิ่มงาน "${task.title}" เรียบร้อยแล้ว`, 'success');
                },

                resetNewTask() {
                    this.newTask = {
                        title: '',
                        description: '',
                        priority: 'medium',
                        status: 'todo',
                        subtasks: []
                    };
                },

                addSubtask() {
                    this.newTask.subtasks.push({ title: '' });
                },

                removeSubtask(index) {
                    this.newTask.subtasks.splice(index, 1);
                },

                // Media management
                getFilteredMedia() {
                    if (this.mediaFilter === 'all') {
                        return this.mediaItems;
                    }
                    return this.mediaItems.filter(media => media.type === this.mediaFilter);
                },

                addMedia() {
                    const newId = Math.max(...this.mediaItems.map(m => m.id), 0) + 1;
                    const media = {
                        id: newId,
                        title: this.newMedia.title,
                        type: this.newMedia.type,
                        url: this.newMedia.url,
                        description: this.newMedia.description,
                        createdAt: new Date()
                    };
                    
                    this.mediaItems.push(media);
                    this.saveDataToStorage();
                    this.resetNewMedia();
                    this.showMediaAdd = false;
                    this.showNotification(`เพิ่มสื่อ "${media.title}" เรียบร้อยแล้ว`, 'success');
                },

                resetNewMedia() {
                    this.newMedia = {
                        title: '',
                        type: 'youtube',
                        url: '',
                        description: ''
                    };
                },

                removeMedia(id) {
                    this.mediaItems = this.mediaItems.filter(media => media.id !== id);
                    this.saveDataToStorage();
                    this.showNotification('ลบสื่อเรียบร้อยแล้ว', 'success');
                },

                playMedia(media) {
                    // Open media URL in new tab
                    window.open(media.url, '_blank');
                },

                getYouTubeEmbedUrl(url) {
                    const videoId = this.extractYouTubeVideoId(url);
                    return videoId ? `https://www.youtube.com/embed/${videoId}` : '';
                },

                getSpotifyEmbedUrl(url) {
                    // Convert Spotify URL to embed format
                    const match = url.match(/spotify\.com\/(track|playlist|album)\/([a-zA-Z0-9]+)/);
                    if (match) {
                        return `https://open.spotify.com/embed/${match[1]}/${match[2]}`;
                    }
                    return '';
                },

                extractYouTubeVideoId(url) {
                    const match = url.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/)([^&\n?#]+)/);
                    return match ? match[1] : null;
                },

                // Gallery management
                addToGallery() {
                    const newId = Math.max(...this.galleryItems.map(g => g.id), 0) + 1;
                    const item = {
                        id: newId,
                        title: `รูปภาพ ${newId}`,
                        url: `https://picsum.photos/400/400?random=${newId}`,
                        description: 'รูปภาพสวยงาม',
                        createdAt: new Date()
                    };
                    
                    this.galleryItems.push(item);
                    this.saveDataToStorage();
                    this.showNotification('เพิ่มรูปภาพเรียบร้อยแล้ว', 'success');
                },

                removeFromGallery(id) {
                    this.galleryItems = this.galleryItems.filter(item => item.id !== id);
                    this.saveDataToStorage();
                    this.showNotification('ลบรูปภาพเรียบร้อยแล้ว', 'success');
                },

                viewImage(item) {
                    window.open(item.url, '_blank');
                },

                // Quick actions
                selectRandomMood() {
                    const randomMood = this.moods[Math.floor(Math.random() * this.moods.length)];
                    this.selectMood(randomMood);
                },

                setQuickPrompt(prompt) {
                    this.aiPrompt = prompt;
                },

                // Mood management
                selectMood(mood) {
                    this.currentMood = mood;
                    this.saveDataToStorage();
                    this.showNotification(`เลือกอารมณ์: ${mood.name} ${mood.emoji}`, 'success');
                },

                saveMoodLog() {
                    if (!this.currentMood) return;
                    
                    const moodEntry = {
                        date: new Date(),
                        mood: this.currentMood
                    };
                    
                    this.moodHistory.push(moodEntry);
                    if (this.moodHistory.length > 10) {
                        this.moodHistory = this.moodHistory.slice(-10);
                    }
                    
                    this.saveDataToStorage();
                    this.showNotification(`บันทึกอารมณ์ ${this.currentMood.name} แล้ว`, 'success');
                },

                async getAIRecommendations() {
                    if (!this.currentMood || !window.Poe) {
                        this.showNotification('กรุณาเลือกอารมณ์และตรวจสอบการเชื่อมต่อ AI', 'error');
                        return;
                    }
                    
                    this.aiLoading = true;
                    this.aiRecommendations = '';
                    
                    try {
                        const prompt = `@Claude-Sonnet-4 ฉันรู้สึก${this.currentMood.name} (${this.currentMood.description}) วันนี้ ช่วยแนะนำงานหรือกิจกรรมที่เหมาะกับอารมณ์นี้ พร้อมเหตุผลว่าทำไมถึงเหมาะสม แบ่งเป็นหมวดหมู่ชัดเจน และให้คำแนะนำแบบ step-by-step ที่ทำตามง่าย เหมาะสำหรับคนที่มีสมาธิสั้น`;
                        
                        await window.Poe.sendUserMessage(prompt, {
                            handler: "mood-recommendation",
                            stream: true,
                            openChat: false
                        });
                        
                        this.showNotification('กำลังขอคำแนะนำจาก AI...', 'info');
                    } catch (error) {
                        console.error('Error getting AI recommendations:', error);
                        this.aiLoading = false;
                        this.aiRecommendations = '<p class="text-error">เกิดข้อผิดพลาดในการขอคำแนะนำ กรุณาลองใหม่อีกครั้ง</p>';
                        this.showNotification('เกิดข้อผิดพลาดในการขอคำแนะนำจาก AI', 'error');
                    }
                },

                async getCustomAIAdvice() {
                    if (!this.aiPrompt.trim() || !window.Poe) {
                        this.showNotification('กรุณาใส่คำถามและตรวจสอบการเชื่อมต่อ AI', 'error');
                        return;
                    }
                    
                    this.aiLoading = true;
                    this.aiResponse = '';
                    
                    try {
                        const moodContext = this.currentMood ? 
                            `\n\nบริบทเพิ่มเติม: ฉันรู้สึก${this.currentMood.name} (${this.currentMood.description}) อยู่ในขณะนี้` : '';
                        
                        const prompt = `@Claude-Sonnet-4 ${this.aiPrompt}${moodContext}
                        
                        กรุณาให้คำแนะนำที่:
                        1. แบ่งเป็นขั้นตอนชัดเจน 
                        2. ใช้ภาษาไทยที่เข้าใจง่าย
                        3. เหมาะกับผู้ที่มีสมาธิสั้น (ขั้นตอนสั้นๆ ชัดเจน)
                        4. สามารถนำไปปฏิบัติได้จริง
                        5. มีการแบ่งงานย่อยถ้าจำเป็น`;
                        
                        await window.Poe.sendUserMessage(prompt, {
                            handler: "custom-advice",
                            stream: true,
                            openChat: false
                        });
                        
                        this.showNotification('กำลังขอคำแนะนำจาก AI...', 'info');
                    } catch (error) {
                        console.error('Error getting custom AI advice:', error);
                        this.aiLoading = false;
                        this.aiResponse = '<p class="text-error">เกิดข้อผิดพลาดในการขอคำแนะนำ กรุณาลองใหม่อีกครั้ง</p>';
                        this.showNotification('เกิดข้อผิดพลาดในการขอคำแนะนำจาก AI', 'error');
                    }
                },

                handleAIResponse(result, type) {
                    const response = result.responses[0];
                    
                    if (response.status === "error") {
                        this.aiLoading = false;
                        const errorMsg = '<p class="text-error">เกิดข้อผิดพลาด: ' + (response.statusText || 'ไม่ทราบสาเหตุ') + '</p>';
                        if (type === 'recommendations') {
                            this.aiRecommendations = errorMsg;
                        } else {
                            this.aiResponse = errorMsg;
                        }
                        this.showNotification('เกิดข้อผิดพลาดจาก AI', 'error');
                        return;
                    }
                    
                    // Convert markdown to HTML
                    let content = response.content
                        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                        .replace(/\*(.*?)\*/g, '<em>$1</em>')
                        .replace(/^### (.*$)/gm, '<h3 class="text-lg font-semibold mt-4 mb-2">$1</h3>')
                        .replace(/^## (.*$)/gm, '<h2 class="text-xl font-semibold mt-6 mb-3">$1</h2>')
                        .replace(/^# (.*$)/gm, '<h1 class="text-2xl font-bold mt-8 mb-4">$1</h1>')
                        .replace(/^\- (.*$)/gm, '<li class="ml-4">• $1</li>')
                        .replace(/^\d+\. (.*$)/gm, '<li class="ml-4 list-decimal">$1</li>')
                        .replace(/\n/g, '<br>');
                    
                    if (type === 'recommendations') {
                        this.aiRecommendations = content;
                    } else {
                        this.aiResponse = content;
                    }
                    
                    if (response.status === "complete") {
                        this.aiLoading = false;
                        this.showNotification('ได้รับคำแนะนำจาก AI แล้ว', 'success');
                    }
                },

                // Export/Import
                exportData() {
                    try {
                        const dataToExport = {
                            tasks: this.tasks,
                            mediaItems: this.mediaItems,
                            galleryItems: this.galleryItems,
                            moodHistory: this.moodHistory,
                            exportDate: new Date(),
                            version: '2.0'
                        };
                        
                        const dataStr = JSON.stringify(dataToExport, null, 2);
                        const dataBlob = new Blob([dataStr], { type: 'application/json' });
                        const url = URL.createObjectURL(dataBlob);
                        
                        const link = document.createElement('a');
                        link.href = url;
                        link.download = `ashval-pro-backup-${new Date().toISOString().split('T')[0]}.json`;
                        link.click();
                        
                        URL.revokeObjectURL(url);
                        this.showNotification('ส่งออกข้อมูลเรียบร้อยแล้ว', 'success');
                    } catch (error) {
                        console.error('Error exporting data:', error);
                        this.showNotification('เกิดข้อผิดพลาดในการส่งออกข้อมูล', 'error');
                    }
                },

                // Utility functions
                formatDate(date) {
                    return new Date(date).toLocaleDateString('th-TH', {
                        day: 'numeric',
                        month: 'short'
                    });
                },

                formatDateTime(date) {
                    return new Date(date).toLocaleDateString('th-TH', {
                        day: 'numeric',
                        month: 'short',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                },

                getPriorityColor(priority) {
                    const colors = {
                        high: 'bg-error/20 text-error',
                        medium: 'bg-warning/20 text-warning',
                        low: 'bg-success/20 text-success'
                    };
                    return colors[priority] || colors.medium;
                },

                getPriorityText(priority) {
                    const texts = {
                        high: 'สูง',
                        medium: 'กลาง',
                        low: 'ต่ำ'
                    };
                    return texts[priority] || texts.medium;
                },

                getStatusText(status) {
                    const texts = {
                        todo: 'รอทำ',
                        doing: 'กำลังทำ',
                        done: 'เสร็จแล้ว'
                    };
                    return texts[status] || texts.todo;
                }
            }
        }
    </script>
</body>
</html>
